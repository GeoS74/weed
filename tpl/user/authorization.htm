<!DOCTYPE HTML><html lang="ru"><head><title><?=PAGE_TITLE?></title>
<?include_once ROOT_PATH.'/tpl/common/header.htm'?>
<style>form{position:relative;width:400px;margin:0 auto;padding:0 0 15px 0;box-shadow:1px 1px 0 .5px #369;border:0 solid #EEE;border-radius:15px}h1{margin:0;padding:10px;color:#3F51B5;font-size:2.4em;text-align:center;cursor:default}input,span{margin:5px 20px}input[type=text],input[type=password],input[type=email]{width:75%;padding:10px 20px}input[type=submit]{padding:5px 25px;background-color:#3F51B5;border:0;border-radius:5px;color:#fff;cursor:pointer;font-size:.9em}input[type=submit]:hover{background-color:#283593}#mode{float:right;font-size:.9em}#mode:hover{cursor:pointer;text-decoration:underline;color:#3F51B5}.message{display:inline-block;margin:5px 20px}</style><script type="text/javascript" src="<?=BASE?>/lib/dev/Elementary.js"></script>
</head><body><script>let frontend_data={tmpl_data:{module:'<?=MODULE?>',template:'<?=TEMPLATE?>',event:'login',},form_data:{}};let form=new El('<form method="post">').setPath('<?=BACKEND_CONTROLLER?>').setData(frontend_data).on('submit',function(){event.preventDefault()}).setHandler(function(){if(this.getVal().login===!0||this.getVal().register===!0)window.location.href='<?=BASE?>/login'}).render('beforeend','<h1>Форма входа</h1>').render();new El('<span class="message"></span>',form).setHandler(function(){if(this.model.getVal().errors&&this.model.getVal().errors.length){this.setParentNode(form.elem.querySelector('h1')).render('afterend');this.elem.style.color='red';this.elem.innerHTML=this.model.getVal().errors}else if(this.model.getVal().login===!0||this.model.getVal().register===!0){this.setParentNode(form.elem.querySelector('h1')).render('afterend');this.elem.style.color='#3F51B5';this.elem.innerHTML='Вы успешно '+(this.model.getVal().login?'авторизировались.':'зарегестрировались.')+'<br><br>';this.elem.innerHTML+='Сейчас Вы будете перенаправлены на главную страницу. Если этого не произошло в течении 10 сек перейдите ';this.elem.innerHTML+='<a href="<?=BASE?>/login">по ссылке</a>'}});new El('<input type="text" name="name" placeholder="login..." pattern="[a-zA-Z0-9-_+\s]{3,}" required autofocus/>',form).setParentNode(form.elem).render();new El('<input type="password" name="pass" placeholder="password..." pattern="[a-zA-Z0-9-_*?#~%]{3,}" required/>',form).setParentNode(form.elem).render();new El('<input type="email" name="email" placeholder="email..." pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}" required/>',form).setParentNode(form.elem).setHandler(function(){switch(this.model.getVal().event){case 'regMode':this.setParentNode(form.elem.querySelector('input[type=submit]')).render('beforebegin');break;case 'loginMode':this.elem.remove();break}});new El('<input type="submit" value="Войти"/>').setParentNode(form.elem).render().on('click',function(){frontend_data.form_data=new FormData(form.elem);if(!checkData(frontend_data.form_data)){frontend_data.form_data={};return}
frontend_data.tmpl_data.event=form.elem.querySelector('#mode')?form.elem.querySelector('#mode').dataset.mode:'login';form.setVal({event:'reset'});form.query()});<?IF(REGISTRATE_MODE):?>new El('<span id="mode" data-mode="login">Регистрация</span>').setParentNode(form.elem).render().on('click',function(){this.dataset.mode=this.dataset.mode=="register"?"login":"register";if(this.dataset.mode=="register"){this.innerText="Авторизация";form.setVal({event:'regMode'})}else{this.innerText="Регистрация";form.setVal({event:'loginMode'})}});<?ENDIF?>function checkData(form_data){let iterator=form_data.entries();while(!0){let result=iterator.next();if(result.done)break;switch(result.value[0]){case 'name':if(result.value[1].length<3){form.setVal({'errors':'Слишком короткий логин'});return!1}
if(new RegExp('[^a-zA-Z0-9-_+\s]','g').test(result.value[1])){form.setVal({'errors':'Логин указан не корректно'});return!1}
break;case 'pass':if(result.value[1].length<3){form.setVal({'errors':'Слишком короткий пароль'});return!1}
if(new RegExp('[^a-zA-Z0-9-_*?#~%]','g').test(result.value[1])){form.setVal({'errors':'Пароль указан не корректно'});return!1}
break;case 'email':if(result.value[1].length<5){form.setVal({'errors':'Слишком короткий e-mail'});return!1}
if(!new RegExp('[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}','g').test(result.value[1])){form.setVal({'errors':'e-mail указан не корректно'});return!1}
break}}
return!0}
function setTopPositionForm(){form.elem.style.top=(document.documentElement.clientHeight/2-form.elem.offsetHeight/2)+'px'}
setTopPositionForm();window.addEventListener('resize',setTopPositionForm)</script></body></html>